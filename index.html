<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cautio - Issue Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: #0a0a0a;
            color: #e5e5e5;
        }
        
        .sidebar {
            background: #1a1a1a;
            border-right: 1px solid #2a2a2a;
        }
        
        .menu-item {
            transition: all 0.2s ease;
        }
        
        .menu-item:hover {
            background: #2a2a2a;
        }
        
        .menu-item.active {
            background: #2563eb;
            color: white;
        }
        
        .accordion-header {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            transition: all 0.3s ease;
        }
        
        .accordion-header:hover {
            background: #252525;
            border-color: #3a3a3a;
        }
        
        .accordion-header.expanded {
            border-color: #2563eb;
            background: #1e293b;
        }
        
        .accordion-content {
            background: #141414;
            border: 1px solid #2a2a2a;
            border-top: none;
        }
        
        .issue-card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            transition: all 0.2s ease;
        }
        
        .issue-card:hover {
            background: #252525;
            border-color: #3a3a3a;
            transform: translateX(4px);
        }
        
        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
        }
        
        .badge-count {
            background: #dc2626;
            color: white;
        }
        
        .badge-age {
            background: #f59e0b;
            color: white;
        }
        
        .badge-status {
            background: #10b981;
            color: white;
        }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #334155;
        }
        
        .loading-spinner {
            border: 3px solid #2a2a2a;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chevron {
            transition: transform 0.3s ease;
        }
        
        .chevron.expanded {
            transform: rotate(90deg);
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const CautioTracker = () => {
            const [data, setData] = useState({ issues: [] });
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [lastUpdated, setLastUpdated] = useState(null);
            const [selectedIssue, setSelectedIssue] = useState(null);
            const [expandedAssignees, setExpandedAssignees] = useState({});
            const [expandedClients, setExpandedClients] = useState({});
            const [expandedLocations, setExpandedLocations] = useState({});
            const [expandedSubRequests, setExpandedSubRequests] = useState({});

            // Google Sheet configuration
            const SHEET_ID = '1DzW-6Q7hTNn2hSJbEHOkSrbalOmbDIftdjw4I_PhEdA';
            const SHEET_NAME = 'Issues- Realtime';
            const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;

            const calculateAge = (raisedDate, resolvedDate) => {
                if (!raisedDate) return 0;
                const raised = new Date(raisedDate);
                const resolved = resolvedDate && resolvedDate.trim() !== '' ? new Date(resolvedDate) : new Date();
                const diffTime = Math.abs(resolved - raised);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            };

            const parseStatus = (resolvedValue, followUpDate) => {
                const resolved = (resolvedValue || '').toString().toLowerCase().trim();
                if (resolved === 'yes') return 'Closed';
                if (followUpDate && followUpDate.trim() !== '') return 'On Hold';
                return 'Open';
            };

            const fetchSheetData = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    const response = await fetch(CSV_URL);
                    if (!response.ok) throw new Error('Failed to fetch data');
                    const csvText = await response.text();
                    
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            const processedIssues = results.data.map((row, index) => {
                                const status = parseStatus(row['Resolved Y/N'], row['Next Follow Up Date']);
                                const createdDate = row['Timestamp Issues raised'] || '';
                                const age = calculateAge(createdDate, row['Timestamp Issues Resolved']);

                                return {
                                    id: index + 1,
                                    issueId: row['Issue ID'] || '',
                                    assignedTo: row['Assigned To'] || '',
                                    client: row['Clients'] || '',
                                    subRequest: row['Sub-request'] || '',
                                    issueDetails: row['Issue Details'] || '',
                                    status: status,
                                    createdDate: createdDate,
                                    resolvedDate: row['Timestamp Issues Resolved'] || '',
                                    vehicleNo: row['Vehicle Number'] || '',
                                    location: row['Location'] || '',
                                    area: row['Area'] || '',
                                    city: row['City'] || '',
                                    nextFollowUpDate: row['Next Follow Up Date'] || '',
                                    raisedBy: row['Raised by'] || '',
                                    raisedVia: row['Raised via [Forum]'] || '',
                                    jiraTicketId: row['JIRA ticket ID'] || '',
                                    dateCurrentStatus: row['Date - Current Status'] || '',
                                    howCorrected: row['How was it corrected?'] || '',
                                    responsiblePerson: row['Responsible Person'] || '',
                                    resolvedYN: row['Resolved Y/N'] || '',
                                    age: age
                                };
                            }).filter(issue => issue.assignedTo || issue.client);

                            setData({ issues: processedIssues });
                            setLastUpdated(new Date());
                            setLoading(false);
                        },
                        error: (error) => {
                            throw new Error(`CSV parsing error: ${error.message}`);
                        }
                    });
                } catch (err) {
                    setError(err.message);
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchSheetData();
                const interval = setInterval(fetchSheetData, 5 * 60 * 1000);
                return () => clearInterval(interval);
            }, []);

            // Calculate assignee summary
            const assigneeSummary = useMemo(() => {
                const openIssues = data.issues.filter(i => i.status === 'Open');
                const summary = {};
                
                openIssues.forEach(issue => {
                    if (!summary[issue.assignedTo]) {
                        summary[issue.assignedTo] = {};
                    }
                    const key = issue.subRequest;
                    if (!summary[issue.assignedTo][key]) {
                        summary[issue.assignedTo][key] = [];
                    }
                    summary[issue.assignedTo][key].push(issue);
                });

                const result = [];
                Object.keys(summary).forEach(assignee => {
                    let totalCount = 0;
                    let oldestDate = new Date();
                    
                    const subRequests = Object.entries(summary[assignee]).map(([subRequest, issues]) => {
                        totalCount += issues.length;
                        issues.forEach(issue => {
                            const date = new Date(issue.createdDate);
                            if (date < oldestDate) oldestDate = date;
                        });
                        return { subRequest, issues };
                    });

                    const daysDiff = Math.floor((new Date() - oldestDate) / (1000 * 60 * 60 * 24));
                    
                    result.push({
                        assignedTo: assignee,
                        subRequests: subRequests,
                        totalCount: totalCount,
                        oldestIssueAge: daysDiff
                    });
                });

                return result.sort((a, b) => a.assignedTo.localeCompare(b.assignedTo));
            }, [data]);

            // Calculate client summary
            const clientSummary = useMemo(() => {
                const openIssues = data.issues.filter(i => i.status === 'Open');
                const summary = {};
                
                openIssues.forEach(issue => {
                    if (!summary[issue.client]) {
                        summary[issue.client] = { issues: [], subRequests: {} };
                    }
                    summary[issue.client].issues.push(issue);
                    
                    if (!summary[issue.client].subRequests[issue.subRequest]) {
                        summary[issue.client].subRequests[issue.subRequest] = [];
                    }
                    summary[issue.client].subRequests[issue.subRequest].push(issue);
                });

                return Object.keys(summary).map(client => ({
                    client,
                    count: summary[client].issues.length,
                    subRequests: Object.entries(summary[client].subRequests).map(([subRequest, issues]) => ({
                        subRequest,
                        issues
                    }))
                })).sort((a, b) => b.count - a.count);
            }, [data]);

            // Calculate location summary
            const locationSummary = useMemo(() => {
                const openIssues = data.issues.filter(i => i.status === 'Open');
                const summary = {};
                
                openIssues.forEach(issue => {
                    const location = issue.location || 'Unknown';
                    if (!summary[location]) {
                        summary[location] = { issues: [], subRequests: {} };
                    }
                    summary[location].issues.push(issue);
                    
                    if (!summary[location].subRequests[issue.subRequest]) {
                        summary[location].subRequests[issue.subRequest] = [];
                    }
                    summary[location].subRequests[issue.subRequest].push(issue);
                });

                return Object.keys(summary).map(location => ({
                    location,
                    count: summary[location].issues.length,
                    subRequests: Object.entries(summary[location].subRequests).map(([subRequest, issues]) => ({
                        subRequest,
                        issues
                    }))
                })).sort((a, b) => b.count - a.count);
            }, [data]);

            const stats = useMemo(() => {
                const total = data.issues.length;
                const open = data.issues.filter(i => i.status === 'Open').length;
                const closed = data.issues.filter(i => i.status === 'Closed').length;
                const onHold = data.issues.filter(i => i.status === 'On Hold').length;
                return { total, open, closed, onHold };
            }, [data]);

            const toggleAssignee = (assignee) => {
                setExpandedAssignees(prev => ({
                    ...prev,
                    [assignee]: !prev[assignee]
                }));
            };

            const toggleSubRequest = (key) => {
                setExpandedSubRequests(prev => ({
                    ...prev,
                    [key]: !prev[key]
                }));
            };

            const toggleClient = (client) => {
                setExpandedClients(prev => ({
                    ...prev,
                    [client]: !prev[client]
                }));
            };

            const toggleLocation = (location) => {
                setExpandedLocations(prev => ({
                    ...prev,
                    [location]: !prev[location]
                }));
            };

            // Render Dashboard
            const renderDashboard = () => (
                <div className="space-y-4">
                    {assigneeSummary.map((assigneeItem, idx) => (
                        <div key={idx}>
                            {/* Assignee Header - Accordion */}
                            <div
                                onClick={() => toggleAssignee(assigneeItem.assignedTo)}
                                className={`accordion-header cursor-pointer rounded-lg p-4 flex items-center justify-between ${
                                    expandedAssignees[assigneeItem.assignedTo] ? 'expanded' : ''
                                }`}
                            >
                                <div className="flex items-center gap-4">
                                    <svg 
                                        className={`w-5 h-5 text-gray-400 chevron ${expandedAssignees[assigneeItem.assignedTo] ? 'expanded' : ''}`}
                                        fill="none" 
                                        stroke="currentColor" 
                                        viewBox="0 0 24 24"
                                    >
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                    <span className="text-lg font-bold text-white">{assigneeItem.assignedTo}</span>
                                    <span className="badge badge-count">{assigneeItem.totalCount}</span>
                                    <span className="badge badge-age">{assigneeItem.oldestIssueAge}d</span>
                                </div>
                            </div>

                            {/* Expanded Content */}
                            {expandedAssignees[assigneeItem.assignedTo] && (
                                <div className="accordion-content rounded-b-lg p-4 space-y-3 mt-1">
                                    {assigneeItem.subRequests.map((sr, srIdx) => {
                                        const subReqKey = `${assigneeItem.assignedTo}-${sr.subRequest}`;
                                        return (
                                            <div key={srIdx}>
                                                {/* Sub-request Header */}
                                                <div
                                                    onClick={() => toggleSubRequest(subReqKey)}
                                                    className="cursor-pointer bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 rounded-lg p-3 flex items-center gap-3 transition"
                                                >
                                                    <svg 
                                                        className={`w-4 h-4 text-gray-500 chevron ${expandedSubRequests[subReqKey] ? 'expanded' : ''}`}
                                                        fill="none" 
                                                        stroke="currentColor" 
                                                        viewBox="0 0 24 24"
                                                    >
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path>
                                                    </svg>
                                                    <span className="badge" style={{background: '#3b82f6', color: 'white'}}>{sr.issues.length}</span>
                                                    <span className="text-sm font-semibold text-gray-300">{sr.subRequest}</span>
                                                </div>

                                                {/* Individual Issues */}
                                                {expandedSubRequests[subReqKey] && (
                                                    <div className="ml-8 mt-2 space-y-2">
                                                        {sr.issues.map((issue, issueIdx) => (
                                                            <div
                                                                key={issueIdx}
                                                                onClick={() => setSelectedIssue({ type: 'single', issue })}
                                                                className="issue-card cursor-pointer rounded-lg p-3"
                                                            >
                                                                <div className="flex items-center justify-between">
                                                                    <div className="flex items-center gap-3 flex-1">
                                                                        <span className="text-xs font-mono text-gray-500">{issue.issueId}</span>
                                                                        <span className="text-sm font-semibold text-blue-400">{issue.client}</span>
                                                                        <span className="text-xs text-gray-400 truncate max-w-xs">{issue.issueDetails || 'No details'}</span>
                                                                    </div>
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-xs font-mono text-gray-500">{issue.vehicleNo}</span>
                                                                        <span className="text-xs text-gray-500">{issue.location}</span>
                                                                        <span className="badge badge-age">{issue.age}d</span>
                                                                        <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path>
                                                                        </svg>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );

            // Render Client Tab
            const renderClientTab = () => (
                <div className="space-y-4">
                    {clientSummary.map((clientItem, idx) => (
                        <div key={idx}>
                            <div
                                onClick={() => toggleClient(clientItem.client)}
                                className={`accordion-header cursor-pointer rounded-lg p-4 flex items-center justify-between ${
                                    expandedClients[clientItem.client] ? 'expanded' : ''
                                }`}
                            >
                                <div className="flex items-center gap-4">
                                    <svg 
                                        className={`w-5 h-5 text-gray-400 chevron ${expandedClients[clientItem.client] ? 'expanded' : ''}`}
                                        fill="none" 
                                        stroke="currentColor" 
                                        viewBox="0 0 24 24"
                                    >
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                    <span className="text-lg font-bold text-white">{clientItem.client}</span>
                                    <span className="badge badge-count">{clientItem.count}</span>
                                </div>
                            </div>

                            {expandedClients[clientItem.client] && (
                                <div className="accordion-content rounded-b-lg p-4 space-y-3 mt-1">
                                    {clientItem.subRequests.map((sr, srIdx) => {
                                        const subReqKey = `client-${clientItem.client}-${sr.subRequest}`;
                                        return (
                                            <div key={srIdx}>
                                                <div
                                                    onClick={() => toggleSubRequest(subReqKey)}
                                                    className="cursor-pointer bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 rounded-lg p-3 flex items-center gap-3 transition"
                                                >
                                                    <svg 
                                                        className={`w-4 h-4 text-gray-500 chevron ${expandedSubRequests[subReqKey] ? 'expanded' : ''}`}
                                                        fill="none" 
                                                        stroke="currentColor" 
                                                        viewBox="0 0 24 24"
                                                    >
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path>
                                                    </svg>
                                                    <span className="badge" style={{background: '#3b82f6', color: 'white'}}>{sr.issues.length}</span>
                                                    <span className="text-sm font-semibold text-gray-300">{sr.subRequest}</span>
                                                </div>

                                                {expandedSubRequests[subReqKey] && (
                                                    <div className="ml-8 mt-2 space-y-2">
                                                        {sr.issues.map((issue, issueIdx) => (
                                                            <div
                                                                key={issueIdx}
                                                                onClick={() => setSelectedIssue({ type: 'single', issue })}
                                                                className="issue-card cursor-pointer rounded-lg p-3"
                                                            >
                                                                <div className="flex items-center justify-between">
                                                                    <div className="flex items-center gap-3 flex-1">
                                                                        <span className="text-xs font-mono text-gray-500">{issue.issueId}</span>
                                                                        <span className="text-sm font-semibold text-blue-400">{issue.assignedTo}</span>
                                                                        <span className="text-xs text-gray-400 truncate max-w-xs">{issue.issueDetails || 'No details'}</span>
                                                                    </div>
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-xs font-mono text-gray-500">{issue.vehicleNo}</span>
                                                                        <span className="badge badge-age">{issue.age}d</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );

            // Render Location Tab
            const renderLocationTab = () => (
                <div className="space-y-4">
                    {locationSummary.map((locationItem, idx) => (
                        <div key={idx}>
                            <div
                                onClick={() => toggleLocation(locationItem.location)}
                                className={`accordion-header cursor-pointer rounded-lg p-4 flex items-center justify-between ${
                                    expandedLocations[locationItem.location] ? 'expanded' : ''
                                }`}
                            >
                                <div className="flex items-center gap-4">
                                    <svg 
                                        className={`w-5 h-5 text-gray-400 chevron ${expandedLocations[locationItem.location] ? 'expanded' : ''}`}
                                        fill="none" 
                                        stroke="currentColor" 
                                        viewBox="0 0 24 24"
                                    >
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                    <span className="text-lg font-bold text-white">{locationItem.location}</span>
                                    <span className="badge badge-count">{locationItem.count}</span>
                                </div>
                            </div>

                            {expandedLocations[locationItem.location] && (
                                <div className="accordion-content rounded-b-lg p-4 space-y-3 mt-1">
                                    {locationItem.subRequests.map((sr, srIdx) => {
                                        const subReqKey = `location-${locationItem.location}-${sr.subRequest}`;
                                        return (
                                            <div key={srIdx}>
                                                <div
                                                    onClick={() => toggleSubRequest(subReqKey)}
                                                    className="cursor-pointer bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 rounded-lg p-3 flex items-center gap-3 transition"
                                                >
                                                    <svg 
                                                        className={`w-4 h-4 text-gray-500 chevron ${expandedSubRequests[subReqKey] ? 'expanded' : ''}`}
                                                        fill="none" 
                                                        stroke="currentColor" 
                                                        viewBox="0 0 24 24"
                                                    >
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path>
                                                    </svg>
                                                    <span className="badge" style={{background: '#3b82f6', color: 'white'}}>{sr.issues.length}</span>
                                                    <span className="text-sm font-semibold text-gray-300">{sr.subRequest}</span>
                                                </div>

                                                {expandedSubRequests[subReqKey] && (
                                                    <div className="ml-8 mt-2 space-y-2">
                                                        {sr.issues.map((issue, issueIdx) => (
                                                            <div
                                                                key={issueIdx}
                                                                onClick={() => setSelectedIssue({ type: 'single', issue })}
                                                                className="issue-card cursor-pointer rounded-lg p-3"
                                                            >
                                                                <div className="flex items-center justify-between">
                                                                    <div className="flex items-center gap-3 flex-1">
                                                                        <span className="text-xs font-mono text-gray-500">{issue.issueId}</span>
                                                                        <span className="text-sm font-semibold text-blue-400">{issue.client}</span>
                                                                        <span className="text-xs text-gray-400 truncate max-w-xs">{issue.issueDetails || 'No details'}</span>
                                                                    </div>
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-xs font-mono text-gray-500">{issue.vehicleNo}</span>
                                                                        <span className="badge badge-age">{issue.age}d</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="loading-spinner mx-auto mb-4"></div>
                            <p className="text-gray-400">Loading data...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-8">
                        <div className="bg-red-900/20 border border-red-500 rounded-lg p-6 max-w-2xl">
                            <h2 className="text-xl font-bold text-red-400 mb-4">Error Loading Data</h2>
                            <p className="text-gray-300 mb-4">{error}</p>
                            <button 
                                onClick={fetchSheetData}
                                className="px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg font-semibold transition"
                            >
                                Retry
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex h-screen">
                    {/* Sidebar */}
                    <div className="sidebar w-64 flex-shrink-0 p-4">
                        <div className="mb-8">
                            <h1 className="text-2xl font-black text-white flex items-center gap-2">
                                cautio
                                <span className="text-xs bg-blue-600 text-white px-2 py-1 rounded">BETA</span>
                            </h1>
                        </div>

                        <div className="space-y-2">
                            <div className="text-xs uppercase text-gray-500 font-semibold mb-2 px-3">MENU</div>
                            
                            <div
                                onClick={() => setActiveTab('dashboard')}
                                className={`menu-item cursor-pointer px-3 py-2 rounded-lg flex items-center gap-3 ${
                                    activeTab === 'dashboard' ? 'active' : ''
                                }`}
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                <span className="font-semibold">Dashboard</span>
                            </div>

                            <div
                                onClick={() => setActiveTab('client')}
                                className={`menu-item cursor-pointer px-3 py-2 rounded-lg flex items-center gap-3 ${
                                    activeTab === 'client' ? 'active' : ''
                                }`}
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                                <span className="font-semibold">Client Wise</span>
                            </div>

                            <div
                                onClick={() => setActiveTab('location')}
                                className={`menu-item cursor-pointer px-3 py-2 rounded-lg flex items-center gap-3 ${
                                    activeTab === 'location' ? 'active' : ''
                                }`}
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span className="font-semibold">Location Wise</span>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 overflow-y-auto">
                        {/* Header */}
                        <div className="bg-zinc-900 border-b border-zinc-800 p-4 sticky top-0 z-10">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h2 className="text-xl font-bold text-white">Issue Tracking Dashboard</h2>
                                    {lastUpdated && (
                                        <p className="text-xs text-gray-500 mt-1">
                                            Last updated: {lastUpdated.toLocaleTimeString()}
                                        </p>
                                    )}
                                </div>
                                <div className="flex items-center gap-4">
                                    <button
                                        onClick={fetchSheetData}
                                        className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition text-sm"
                                    >
                                        ðŸ”„ Refresh
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Stats */}
                        <div className="p-6">
                            <div className="grid grid-cols-4 gap-4 mb-6">
                                <div className="stats-card rounded-lg p-4">
                                    <div className="text-sm text-gray-400 mb-1">Total Issues</div>
                                    <div className="text-3xl font-bold text-white">{stats.total}</div>
                                </div>
                                <div className="stats-card rounded-lg p-4">
                                    <div className="text-sm text-gray-400 mb-1">Open</div>
                                    <div className="text-3xl font-bold text-red-400">{stats.open}</div>
                                </div>
                                <div className="stats-card rounded-lg p-4">
                                    <div className="text-sm text-gray-400 mb-1">Closed</div>
                                    <div className="text-3xl font-bold text-green-400">{stats.closed}</div>
                                </div>
                                <div className="stats-card rounded-lg p-4">
                                    <div className="text-sm text-gray-400 mb-1">On Hold</div>
                                    <div className="text-3xl font-bold text-yellow-400">{stats.onHold}</div>
                                </div>
                            </div>

                            {/* Content Area */}
                            {activeTab === 'dashboard' && renderDashboard()}
                            {activeTab === 'client' && renderClientTab()}
                            {activeTab === 'location' && renderLocationTab()}
                        </div>
                    </div>

                    {/* Issue Detail Modal */}
                    {selectedIssue && selectedIssue.type === 'single' && (
                        <div className="modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4" onClick={() => setSelectedIssue(null)}>
                            <div className="modal-content rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                {/* Modal Header */}
                                <div className="bg-gradient-to-r from-blue-600 to-purple-600 p-6 rounded-t-xl flex justify-between items-center sticky top-0 z-10">
                                    <div>
                                        <h2 className="text-xl font-bold text-white">Issue Details</h2>
                                        <p className="text-sm text-blue-100 mt-1">ID: {selectedIssue.issue.issueId}</p>
                                    </div>
                                    <button 
                                        onClick={() => setSelectedIssue(null)}
                                        className="text-white hover:bg-white/20 rounded-lg p-2 transition"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>

                                {/* Modal Content */}
                                <div className="p-6">
                                    <div className="grid grid-cols-2 gap-6">
                                        {/* Basic Info */}
                                        <div className="space-y-4">
                                            <h3 className="text-sm font-bold text-blue-400 uppercase mb-3">Basic Information</h3>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Issue ID</label>
                                                <p className="text-white font-mono">{selectedIssue.issue.issueId || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Client</label>
                                                <p className="text-white font-semibold">{selectedIssue.issue.client || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Issue Type</label>
                                                <p className="text-white">{selectedIssue.issue.subRequest || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Issue Details</label>
                                                <p className="text-gray-300 bg-zinc-900 p-3 rounded-lg">{selectedIssue.issue.issueDetails || 'No details'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Status</label>
                                                <div className="mt-1">
                                                    <span className={`badge ${
                                                        selectedIssue.issue.status === 'Open' ? 'badge-count' :
                                                        selectedIssue.issue.status === 'Closed' ? 'badge-status' :
                                                        'badge-age'
                                                    }`}>
                                                        {selectedIssue.issue.status}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Assignment */}
                                        <div className="space-y-4">
                                            <h3 className="text-sm font-bold text-purple-400 uppercase mb-3">Assignment & Tracking</h3>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Assigned To</label>
                                                <p className="text-white font-semibold">{selectedIssue.issue.assignedTo || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Raised By</label>
                                                <p className="text-gray-300">{selectedIssue.issue.raisedBy || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Raised Via</label>
                                                <p className="text-gray-300">{selectedIssue.issue.raisedVia || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Responsible Person</label>
                                                <p className="text-gray-300">{selectedIssue.issue.responsiblePerson || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">JIRA Ticket</label>
                                                <p className="text-gray-300 font-mono">{selectedIssue.issue.jiraTicketId || '-'}</p>
                                            </div>
                                        </div>

                                        {/* Location */}
                                        <div className="space-y-4">
                                            <h3 className="text-sm font-bold text-green-400 uppercase mb-3">Location & Vehicle</h3>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Vehicle Number</label>
                                                <p className="text-white font-mono font-bold">{selectedIssue.issue.vehicleNo || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Location</label>
                                                <p className="text-gray-300">{selectedIssue.issue.location || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Area</label>
                                                <p className="text-gray-300">{selectedIssue.issue.area || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">City</label>
                                                <p className="text-gray-300">{selectedIssue.issue.city || '-'}</p>
                                            </div>
                                        </div>

                                        {/* Timeline */}
                                        <div className="space-y-4">
                                            <h3 className="text-sm font-bold text-orange-400 uppercase mb-3">Timeline & Resolution</h3>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Issue Raised</label>
                                                <p className="text-gray-300">{selectedIssue.issue.createdDate || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Issue Resolved</label>
                                                <p className="text-gray-300">{selectedIssue.issue.resolvedDate || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Age (Days)</label>
                                                <p className="text-orange-400 font-bold text-lg">{selectedIssue.issue.age} days</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">Next Follow Up</label>
                                                <p className="text-gray-300">{selectedIssue.issue.nextFollowUpDate || '-'}</p>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-gray-500 uppercase">How Corrected</label>
                                                <p className="text-gray-300 bg-zinc-900 p-3 rounded-lg">{selectedIssue.issue.howCorrected || 'Not yet corrected'}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-6 flex justify-end">
                                        <button
                                            onClick={() => setSelectedIssue(null)}
                                            className="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition"
                                        >
                                            Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<CautioTracker />, document.getElementById('root'));
    </script>
</body>
</html>
